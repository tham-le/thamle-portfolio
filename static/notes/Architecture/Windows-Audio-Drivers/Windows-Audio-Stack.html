<!DOCTYPE html>
<html lang="en" dir="ltr"><head><title>Windows-Audio-Stack</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;family=IBM Plex Mono:wght@400;600&amp;display=swap"/><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="anonymous"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="Tham Le's Notes"/><meta property="og:title" content="Windows-Audio-Stack"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Windows-Audio-Stack"/><meta name="twitter:description" content="Understanding the Windows Audio Architecture Diagram Breaking down the complete Windows audio stack from apps to hardware The Big Picture This diagram shows the complete path audio data takes from applications down to your actual hardware."/><meta property="og:description" content="Understanding the Windows Audio Architecture Diagram Breaking down the complete Windows audio stack from apps to hardware The Big Picture This diagram shows the complete path audio data takes from applications down to your actual hardware."/><meta property="og:image:alt" content="Understanding the Windows Audio Architecture Diagram Breaking down the complete Windows audio stack from apps to hardware The Big Picture This diagram shows the complete path audio data takes from applications down to your actual hardware."/><meta property="og:image" content="https://notes.thamle.live/static/og-image.png"/><meta property="og:image:url" content="https://notes.thamle.live/static/og-image.png"/><meta name="twitter:image" content="https://notes.thamle.live/static/og-image.png"/><meta property="og:image:type" content="image/.png"/><meta property="twitter:domain" content="notes.thamle.live"/><meta property="og:url" content="https://notes.thamle.live/Architecture/Windows-Audio-Drivers/Windows-Audio-Stack"/><meta property="twitter:url" content="https://notes.thamle.live/Architecture/Windows-Audio-Drivers/Windows-Audio-Stack"/><link rel="icon" href="../../static/icon.png"/><meta name="description" content="Understanding the Windows Audio Architecture Diagram Breaking down the complete Windows audio stack from apps to hardware The Big Picture This diagram shows the complete path audio data takes from applications down to your actual hardware."/><meta name="generator" content="Quartz"/><link href="../../index.css" rel="stylesheet" type="text/css" spa-preserve/><style>.expand-button {
  position: absolute;
  display: flex;
  float: right;
  padding: 0.4rem;
  margin: 0.3rem;
  right: 0;
  color: var(--gray);
  border-color: var(--dark);
  background-color: var(--light);
  border: 1px solid;
  border-radius: 5px;
  opacity: 0;
  transition: 0.2s;
}
.expand-button > svg {
  fill: var(--light);
  filter: contrast(0.3);
}
.expand-button:hover {
  cursor: pointer;
  border-color: var(--secondary);
}
.expand-button:focus {
  outline: 0;
}

pre:hover > .expand-button {
  opacity: 1;
  transition: 0.2s;
}

#mermaid-container {
  position: fixed;
  contain: layout;
  z-index: 999;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  display: none;
  backdrop-filter: blur(4px);
  background: rgba(0, 0, 0, 0.5);
}
#mermaid-container.active {
  display: inline-block;
}
#mermaid-container > #mermaid-space {
  border: 1px solid var(--lightgray);
  background-color: var(--light);
  border-radius: 5px;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  height: 80vh;
  width: 80vw;
  overflow: hidden;
}
#mermaid-container > #mermaid-space > .mermaid-content {
  padding: 2rem;
  position: relative;
  transform-origin: 0 0;
  transition: transform 0.1s ease;
  overflow: visible;
  min-height: 200px;
  min-width: 200px;
}
#mermaid-container > #mermaid-space > .mermaid-content pre {
  margin: 0;
  border: none;
}
#mermaid-container > #mermaid-space > .mermaid-content svg {
  max-width: none;
  height: auto;
}
#mermaid-container > #mermaid-space > .mermaid-controls {
  position: absolute;
  bottom: 20px;
  right: 20px;
  display: flex;
  gap: 8px;
  padding: 8px;
  background: var(--light);
  border: 1px solid var(--lightgray);
  border-radius: 6px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  z-index: 2;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  padding: 0;
  border: 1px solid var(--lightgray);
  background: var(--light);
  color: var(--dark);
  border-radius: 4px;
  cursor: pointer;
  font-size: 16px;
  font-family: var(--bodyFont);
  transition: all 0.2s ease;
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:hover {
  background: var(--lightgray);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:active {
  transform: translateY(1px);
}
#mermaid-container > #mermaid-space > .mermaid-controls .mermaid-control-button:nth-child(2) {
  width: auto;
  padding: 0 12px;
  font-size: 14px;
}
/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VSb290IjoiL2hvbWUvcnVubmVyL3dvcmsvbXktbm90ZXMvbXktbm90ZXMvcXVhcnR6L2NvbXBvbmVudHMvc3R5bGVzIiwic291cmNlcyI6WyJtZXJtYWlkLmlubGluZS5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTtFQUNBOztBQUdGO0VBQ0U7RUFDQTs7QUFHRjtFQUNFOzs7QUFLRjtFQUNFO0VBQ0E7OztBQUlKO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFOztBQUdGO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFO0VBQ0E7O0FBR0Y7RUFDRTtFQUNBOztBQUlKO0VBQ0U7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFQTtFQUNFO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBRUE7RUFDRTs7QUFHRjtFQUNFOztBQUlGO0VBQ0U7RUFDQTtFQUNBIiwic291cmNlc0NvbnRlbnQiOlsiLmV4cGFuZC1idXR0b24ge1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsb2F0OiByaWdodDtcbiAgcGFkZGluZzogMC40cmVtO1xuICBtYXJnaW46IDAuM3JlbTtcbiAgcmlnaHQ6IDA7IC8vIE5PVEU6IHJpZ2h0IHdpbGwgYmUgc2V0IGluIG1lcm1haWQuaW5saW5lLnRzXG4gIGNvbG9yOiB2YXIoLS1ncmF5KTtcbiAgYm9yZGVyLWNvbG9yOiB2YXIoLS1kYXJrKTtcbiAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tbGlnaHQpO1xuICBib3JkZXI6IDFweCBzb2xpZDtcbiAgYm9yZGVyLXJhZGl1czogNXB4O1xuICBvcGFjaXR5OiAwO1xuICB0cmFuc2l0aW9uOiAwLjJzO1xuXG4gICYgPiBzdmcge1xuICAgIGZpbGw6IHZhcigtLWxpZ2h0KTtcbiAgICBmaWx0ZXI6IGNvbnRyYXN0KDAuMyk7XG4gIH1cblxuICAmOmhvdmVyIHtcbiAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1zZWNvbmRhcnkpO1xuICB9XG5cbiAgJjpmb2N1cyB7XG4gICAgb3V0bGluZTogMDtcbiAgfVxufVxuXG5wcmUge1xuICAmOmhvdmVyID4gLmV4cGFuZC1idXR0b24ge1xuICAgIG9wYWNpdHk6IDE7XG4gICAgdHJhbnNpdGlvbjogMC4ycztcbiAgfVxufVxuXG4jbWVybWFpZC1jb250YWluZXIge1xuICBwb3NpdGlvbjogZml4ZWQ7XG4gIGNvbnRhaW46IGxheW91dDtcbiAgei1pbmRleDogOTk5O1xuICBsZWZ0OiAwO1xuICB0b3A6IDA7XG4gIHdpZHRoOiAxMDB2dztcbiAgaGVpZ2h0OiAxMDB2aDtcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgZGlzcGxheTogbm9uZTtcbiAgYmFja2Ryb3AtZmlsdGVyOiBibHVyKDRweCk7XG4gIGJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC41KTtcblxuICAmLmFjdGl2ZSB7XG4gICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICB9XG5cbiAgJiA+ICNtZXJtYWlkLXNwYWNlIHtcbiAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1saWdodGdyYXkpO1xuICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLWxpZ2h0KTtcbiAgICBib3JkZXItcmFkaXVzOiA1cHg7XG4gICAgcG9zaXRpb246IGZpeGVkO1xuICAgIHRvcDogNTAlO1xuICAgIGxlZnQ6IDUwJTtcbiAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTtcbiAgICBoZWlnaHQ6IDgwdmg7XG4gICAgd2lkdGg6IDgwdnc7XG4gICAgb3ZlcmZsb3c6IGhpZGRlbjtcblxuICAgICYgPiAubWVybWFpZC1jb250ZW50IHtcbiAgICAgIHBhZGRpbmc6IDJyZW07XG4gICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgICB0cmFuc2Zvcm0tb3JpZ2luOiAwIDA7XG4gICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4xcyBlYXNlO1xuICAgICAgb3ZlcmZsb3c6IHZpc2libGU7XG4gICAgICBtaW4taGVpZ2h0OiAyMDBweDtcbiAgICAgIG1pbi13aWR0aDogMjAwcHg7XG5cbiAgICAgIHByZSB7XG4gICAgICAgIG1hcmdpbjogMDtcbiAgICAgICAgYm9yZGVyOiBub25lO1xuICAgICAgfVxuXG4gICAgICBzdmcge1xuICAgICAgICBtYXgtd2lkdGg6IG5vbmU7XG4gICAgICAgIGhlaWdodDogYXV0bztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAmID4gLm1lcm1haWQtY29udHJvbHMge1xuICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgYm90dG9tOiAyMHB4O1xuICAgICAgcmlnaHQ6IDIwcHg7XG4gICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgZ2FwOiA4cHg7XG4gICAgICBwYWRkaW5nOiA4cHg7XG4gICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1saWdodCk7XG4gICAgICBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1saWdodGdyYXkpO1xuICAgICAgYm9yZGVyLXJhZGl1czogNnB4O1xuICAgICAgYm94LXNoYWRvdzogMCAycHggNHB4IHJnYmEoMCwgMCwgMCwgMC4xKTtcbiAgICAgIHotaW5kZXg6IDI7XG5cbiAgICAgIC5tZXJtYWlkLWNvbnRyb2wtYnV0dG9uIHtcbiAgICAgICAgZGlzcGxheTogZmxleDtcbiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gICAgICAgIHdpZHRoOiAzMnB4O1xuICAgICAgICBoZWlnaHQ6IDMycHg7XG4gICAgICAgIHBhZGRpbmc6IDA7XG4gICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWxpZ2h0Z3JheSk7XG4gICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWxpZ2h0KTtcbiAgICAgICAgY29sb3I6IHZhcigtLWRhcmspO1xuICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7XG4gICAgICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICAgICAgZm9udC1zaXplOiAxNnB4O1xuICAgICAgICBmb250LWZhbWlseTogdmFyKC0tYm9keUZvbnQpO1xuICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4ycyBlYXNlO1xuXG4gICAgICAgICY6aG92ZXIge1xuICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWxpZ2h0Z3JheSk7XG4gICAgICAgIH1cblxuICAgICAgICAmOmFjdGl2ZSB7XG4gICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKDFweCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTdHlsZSB0aGUgcmVzZXQgYnV0dG9uIGRpZmZlcmVudGx5XG4gICAgICAgICY6bnRoLWNoaWxkKDIpIHtcbiAgICAgICAgICB3aWR0aDogYXV0bztcbiAgICAgICAgICBwYWRkaW5nOiAwIDEycHg7XG4gICAgICAgICAgZm9udC1zaXplOiAxNHB4O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG4iXX0= */</style><link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="../../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("../../static/contentIndex.json").then(data => data.json())</script><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://notes.thamle.live/index.xml"/></head><body data-slug="Architecture/Windows-Audio-Drivers/Windows-Audio-Stack"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href="../..">Tham Le's Notes</a></h2><div class="spacer mobile-only"></div><div class="search"><button class="search-button"><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg><p>Search</p></button><div class="search-container"><div class="search-space"><input autocomplete="off" class="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div class="search-layout" data-preview="true"></div></div></div></div><button class="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" class="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button><div class="explorer desktop-only" data-behavior="link" data-collapsed="collapsed" data-savestate="true" data-data-fns="{&quot;order&quot;:[&quot;filter&quot;,&quot;map&quot;,&quot;sort&quot;],&quot;sortFn&quot;:&quot;(a,b)=>!a.isFolder&amp;&amp;!b.isFolder||a.isFolder&amp;&amp;b.isFolder?a.displayName.localeCompare(b.displayName,void 0,{numeric:!0,sensitivity:\&quot;base\&quot;}):!a.isFolder&amp;&amp;b.isFolder?1:-1&quot;,&quot;filterFn&quot;:&quot;node=>node.slugSegment!==\&quot;tags\&quot;&quot;,&quot;mapFn&quot;:&quot;node=>node&quot;}"><button type="button" class="explorer-toggle mobile-explorer hide-until-loaded" data-mobile="true" aria-controls="explorer-22"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide-menu"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button><button type="button" class="title-button explorer-toggle desktop-explorer" data-mobile="false" aria-expanded="true"><h2>Explorer</h2><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="explorer-22" class="explorer-content" aria-expanded="false" role="group"><ul class="explorer-ul overflow" id="list-0"><li class="overflow-end"></li></ul></div><template id="template-file"><li><a href="#"></a></li></template><template id="template-folder"><li><div class="folder-container"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="5 8 14 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="folder-icon"><polyline points="6 9 12 15 18 9"></polyline></svg><div><button class="folder-button"><span class="folder-title"></span></button></div></div><div class="folder-outer"><ul class="content"></ul></div></li></template></div></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="../../">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../Architecture/">Architecture</a><p> ❯ </p></div><div class="breadcrumb-element"><a href="../../Architecture/Windows-Audio-Drivers/">Windows Audio Drivers</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>Windows Audio Stack</a></div></nav><h1 class="article-title">Windows-Audio-Stack</h1><p show-comma="true" class="content-meta"><time datetime="2025-11-07T13:18:24.151Z">Nov 07, 2025</time><span>6 min read</span></p></div></div><article class="popover-hint"><h1 id="understanding-the-windows-audio-architecture-diagram">Understanding the Windows Audio Architecture Diagram<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#understanding-the-windows-audio-architecture-diagram" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h1>
<p><em>Breaking down the complete Windows audio stack from apps to hardware</em></p>
<h2 id="the-big-picture">The Big Picture<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#the-big-picture" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>This diagram shows the complete path audio data takes from applications down to your actual hardware. It’s split into three horizontal zones:</p>
<ol>
<li><strong><a href="../../User-Mode" class="internal alias" data-slug="User-Mode">User Mode</a></strong> (top): Where your applications live</li>
<li><strong><a href="../../Kernel-Mode" class="internal alias" data-slug="Kernel-Mode">Kernel Mode</a></strong> (middle/bottom): Where drivers and the OS kernel operate</li>
<li><strong>Hardware</strong> (bottom): Your actual audio device</li>
</ol>
<p>The key insight: there’s a clean boundary between <a href="../../User-Mode" class="internal alias" data-slug="User-Mode">User Mode</a> and <a href="../../Kernel-Mode" class="internal alias" data-slug="Kernel-Mode">Kernel Mode</a>. Audio must cross this boundary to reach your hardware.</p>
<h2 id="top-layer-audio-engine-user-mode">Top Layer: Audio Engine (User Mode)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#top-layer-audio-engine-user-mode" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<pre><code>┌─────────────────┐
│  [[Audio Engine]]   │ ← Audiodg.exe process
└────────┬────────┘
         ↓
</code></pre>
<p>This is where all the user-mode audio processing happens (starting in Windows Vista). The <a href="../../Audio-Engine" class="internal alias" data-slug="Audio-Engine">Audio Engine</a>:</p>
<ul>
<li>Mixes audio from multiple applications</li>
<li>Applies audio effects</li>
<li>Handles format conversions</li>
<li>Runs in the <code>Audiodg.exe</code> process</li>
</ul>
<p>Before Vista, this was done by <a href="../../KMixer" class="internal" data-slug="KMixer">KMixer</a> in <a href="../../Kernel-Mode" class="internal alias" data-slug="Kernel-Mode">Kernel Mode</a>. Moving it to <a href="../../User-Mode" class="internal alias" data-slug="User-Mode">User Mode</a> made the audio stack more stable (a crash here doesn’t blue screen your system).</p>
<h2 id="the-bridge-ksendpoint-audioksedll">The Bridge: KSEndpoint (AudioKSE.DLL)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#the-bridge-ksendpoint-audioksedll" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<pre><code>┌──────────────────────┐
│ [[KSEndpoint]]           │ ← AudioKSE.DLL
│ (AudioKSE.DLL)       │
└──────────┬───────────┘
           ↓
═══════════════════════════ [[User Mode]] / [[Kernel Mode]] boundary
           ↓
</code></pre>
<p>This is the critical abstraction layer. <a href="../../KSEndpoint" class="internal" data-slug="KSEndpoint">KSEndpoint</a> (living in AudioKSE.DLL) provides the <a href="../../Audio-Engine" class="internal alias" data-slug="Audio-Engine">Audio Engine</a> with access to <a href="../../Kernel-Mode" class="internal alias" data-slug="Kernel-Mode">Kernel Mode</a> audio endpoints. It:</p>
<ul>
<li>Abstracts the <a href="../../Kernel-Mode" class="internal alias" data-slug="Kernel-Mode">Kernel Mode</a> device endpoint</li>
<li>Translates <a href="../../User-Mode" class="internal alias" data-slug="User-Mode">User Mode</a> audio requests into <a href="../../Kernel-Mode" class="internal alias" data-slug="Kernel-Mode">Kernel Mode</a> operations</li>
<li>Provides a clean interface so the <a href="../../Audio-Engine" class="internal alias" data-slug="Audio-Engine">Audio Engine</a> doesn’t need to know about driver details</li>
</ul>
<p>Think of it as the embassy between user land and kernel land.</p>
<h2 id="kernel-mode-two-paths-to-hardware">Kernel Mode: Two Paths to Hardware<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#kernel-mode-two-paths-to-hardware" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Once you’re in <a href="../../Kernel-Mode" class="internal alias" data-slug="Kernel-Mode">Kernel Mode</a>, the diagram shows <strong>two completely separate driver architectures</strong>:</p>
<h3 id="left-side-avstream-class-drivers-kssys">Left Side: AVStream Class Drivers (KS.SYS)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#left-side-avstream-class-drivers-kssys" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<pre><code>┌────────────────────────────┐
│ [[AVStream]] Class Driver      │ ← KS.SYS
│      (KS.SYS)              │
├────────────┬───────────────┤
│ [[USB]] Audio  │ [[1394]] Audio    │ ← Stream Class Drivers
│(USBAudio.S)│(AVCAudio.SYS) │
└──────┬─────┴───────┬───────┘
       ↓             ↓
┌──────────────────────────┐
│   Bus Class Driver       │ ← USBC.SYS, 1394Bus.SYS
└──────┬───────────────────┘
       ↓
┌──────────────────────────┐
│   [[USB]]/[[1394]] Controller    │ ← Hardware
└──────────────────────────┘
</code></pre>
<p><strong><a href="../../AVStream" class="internal" data-slug="AVStream">AVStream</a> (KS.SYS)</strong> is the general-purpose streaming class driver. It’s used for:</p>
<ul>
<li><a href="../../USB" class="internal" data-slug="USB">USB</a> audio devices</li>
<li><a href="../../IEEE-1394" class="internal alias" data-slug="IEEE-1394">IEEE 1394</a> (FireWire) audio devices</li>
<li>Video capture devices</li>
<li>Other streaming media devices</li>
</ul>
<p>The stream flows: KS.SYS → Bus-specific driver (USBAudio.SYS) → Bus controller → Hardware</p>
<p>This path is for devices that connect via external buses (<a href="../../USB" class="internal" data-slug="USB">USB</a>, FireWire).</p>
<h3 id="right-side-port-class-drivers-portclssys">Right Side: Port Class Drivers (PortCls.SYS)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#right-side-port-class-drivers-portclssys" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h3>
<pre><code>┌─────────────────────────────────────────┐
│   Port Class Driver ([[PortCls]].SYS)      │
├──────┬──────┬──────┬──────┬──────┬─────┤
│Wave  │Wave  │Wave  │[[MIDI]]  │DMus  │Topo │ ← Port Drivers
│Cyclic│ PCI  │ RT   │      │      │logy │
└──┬───┴──┬───┴──┬───┴──┬───┴──┬───┴──┬──┘
   ↓      ↓      ↓      ↓      ↓      ↓
┌────────────────────────────────────────┐
│        [[Adapter Driver]]                  │ ← YOU WRITE THIS
├──────┬──────┬──────┬──────┬──────┬────┤
│Wave  │Wave  │Wave  │[[MIDI]]  │DMus  │Topo│ ← Miniport Drivers
│Cyclic│ PCI  │ RT   │      │      │logy│
└──────┴──────┴──────┴──────┴──────┴────┘
         ↓
┌──────────────────────────────────────────┐
│         Audio Device                     │ ← Your Hardware
└──────────────────────────────────────────┘
</code></pre>
<p><strong><a href="../../PortCls" class="internal" data-slug="PortCls">PortCls</a> (Portcls.sys)</strong> is for <a href="../../PCI" class="internal" data-slug="PCI">PCI</a> and <a href="../../DMA" class="internal" data-slug="DMA">DMA</a>-based audio devices. This is what we’ve been discussing in the previous articles!</p>
<p>Each column shows a <a href="../../Port-Miniport-Driver" class="internal alias" data-slug="Port-Miniport-Driver">Port-Miniport Driver</a> pair:</p>
<ul>
<li><strong>Port Drivers</strong> (top row, cyan): Microsoft provides these in Portcls.sys</li>
<li><strong>Miniport Drivers</strong> (bottom row, cyan): YOU write these for your hardware</li>
<li>Together they form a complete audio subdevice</li>
</ul>
<p>The different types:</p>
<ul>
<li><strong>WaveCyclic/WavePCI/WaveRT</strong>: Different approaches to streaming wave audio (RT is newest)</li>
<li><strong><a href="../../MIDI" class="internal" data-slug="MIDI">MIDI</a></strong>: Basic <a href="../../MIDI" class="internal" data-slug="MIDI">MIDI</a> support</li>
<li><strong>DMus</strong>: Advanced <a href="../../DirectMusic" class="internal" data-slug="DirectMusic">DirectMusic</a> <a href="../../MIDI" class="internal" data-slug="MIDI">MIDI</a></li>
<li><strong>Topology</strong>: Mixer controls (volume, mute, etc.)</li>
</ul>
<p>Your audio card might have multiple miniports (say, WaveRT + Topology + DMus) working together.</p>
<h2 id="the-color-coding-who-writes-what">The Color Coding: Who Writes What?<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#the-color-coding-who-writes-what" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>The diagram uses cyan/blue to show vendor-provided components:</p>
<p><strong>Cyan boxes = You write this:</strong></p>
<ul>
<li>All the miniport drivers in the bottom row</li>
<li>The “Adapter Driver” layer that manages them</li>
</ul>
<p><strong>White/System boxes = Microsoft provides:</strong></p>
<ul>
<li>AVStream class driver (KS.SYS)</li>
<li>PortCls (Portcls.sys)</li>
<li>All the port drivers</li>
<li>Bus class drivers</li>
<li>KSEndpoint</li>
<li>Audio Engine</li>
</ul>
<p>The genius of this architecture: you write a small amount of hardware-specific code. Microsoft handles all the complex kernel streaming, audio mixing, and Windows integration.</p>
<h2 id="following-the-data-flow">Following the Data Flow<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#following-the-data-flow" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>Let’s trace audio from your app to speakers:</p>
<ol>
<li><strong>Your Application</strong> → plays audio via WASAPI/DirectSound/etc.</li>
<li><strong>Audio Engine</strong> (user mode) → mixes it with other apps’ audio</li>
<li><strong>KSEndpoint</strong> (AudioKSE.DLL) → crosses into kernel mode</li>
<li><strong>PortCls</strong> → receives the audio stream</li>
<li><strong>WaveRT Port Driver</strong> → manages the cyclic buffer and timing</li>
<li><strong>Your WaveRT Miniport</strong> → programs your DMA controller</li>
<li><strong>Your Audio Device</strong> → converts digital to analog and drives speakers</li>
</ol>
<p>The data physically flows through the port-miniport pair. The port driver handles the generic “move bytes” work. Your miniport tells the hardware “go read from this address.”</p>
<h2 id="why-two-paths-avstream-vs-portcls">Why Two Paths? (AVStream vs PortCls)<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#why-two-paths-avstream-vs-portcls" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>You might wonder: why have both <a href="../../AVStream" class="internal" data-slug="AVStream">AVStream</a> and <a href="../../PortCls" class="internal" data-slug="PortCls">PortCls</a>?</p>
<p><strong>Use <a href="../../AVStream" class="internal" data-slug="AVStream">AVStream</a> (left side) when:</strong></p>
<ul>
<li>Your device connects via <a href="../../USB" class="internal" data-slug="USB">USB</a> or FireWire</li>
<li>You need general-purpose streaming (video, audio, etc.)</li>
<li>Your device doesn’t have dedicated audio hardware</li>
</ul>
<p><strong>Use <a href="../../PortCls" class="internal" data-slug="PortCls">PortCls</a> (right side) when:</strong></p>
<ul>
<li>Your device is <a href="../../PCI" class="internal" data-slug="PCI">PCI</a>/<a href="../../PCIe" class="internal" data-slug="PCIe">PCIe</a> based</li>
<li>You have dedicated <a href="../../DMA" class="internal" data-slug="DMA">DMA</a>-capable audio hardware</li>
<li>You want the audio-optimized framework with built-in timing support</li>
</ul>
<p>Most professional audio cards use <a href="../../PortCls" class="internal" data-slug="PortCls">PortCls</a> because they’re <a href="../../PCI" class="internal" data-slug="PCI">PCI</a>/<a href="../../PCIe" class="internal" data-slug="PCIe">PCIe</a> devices with dedicated audio <a href="../../DSP" class="internal alias" data-slug="DSP">DSPs</a>.</p>
<h2 id="the-bus-class-driver-layer">The Bus Class Driver Layer<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#the-bus-class-driver-layer" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>On the left side, notice the extra layer:</p>
<pre><code>Stream Class Drivers (USBAudio.SYS, etc.)
         ↓
Bus Class Driver (USBC.SYS, 1394Bus.SYS)
         ↓
[[USB]]/[[1394]] Controller (Hardware)
</code></pre>
<p><a href="../../USB" class="internal" data-slug="USB">USB</a> and FireWire devices need bus-specific drivers to translate audio streaming into <a href="../../USB" class="internal" data-slug="USB">USB</a> packets or FireWire <a href="../../Isochronous-Transfer" class="internal alias" data-slug="Isochronous-Transfer">isochronous streams</a>. Your audio data gets packaged up for transport across the bus.</p>
<p><a href="../../PortCls" class="internal" data-slug="PortCls">PortCls</a> devices on the right side don’t need this because <a href="../../PCI" class="internal" data-slug="PCI">PCI</a>/<a href="../../PCIe" class="internal" data-slug="PCIe">PCIe</a> devices talk directly to system memory via <a href="../../DMA" class="internal" data-slug="DMA">DMA</a>. No special packaging required.</p>
<h2 id="the-adapter-driver-box">The “Adapter Driver” Box<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#the-adapter-driver-box" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>This is your main driver code that:</p>
<ul>
<li>Implements <code>[[DriverEntry]]</code> (the driver entry point)</li>
<li>Creates instances of your miniport drivers</li>
<li>Asks <a href="../../PortCls" class="internal" data-slug="PortCls">PortCls</a> to create matching port drivers</li>
<li>Binds them together</li>
<li>Handles device <a href="../../Power-Management" class="internal alias" data-slug="Power-Management">Power Management</a></li>
</ul>
<p>Think of it as the “manager” that coordinates your various miniport drivers.</p>
<h2 id="what-about-the-hardware">What About the Hardware?<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#what-about-the-hardware" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>The bottom shows:</p>
<ul>
<li><strong><a href="../../USB" class="internal" data-slug="USB">USB</a>/<a href="../../1394" class="internal" data-slug="1394">1394</a> Controller</strong>: The physical chip on your motherboard</li>
<li><strong>Audio Device</strong>: Your actual audio hardware (could be on the motherboard, a sound card, or external)</li>
</ul>
<p>Everything above this is software. Everything at this level is silicon.</p>
<h2 id="modern-note-wavert-wins">Modern Note: WaveRT Wins<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#modern-note-wavert-wins" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>The diagram shows three wave port types (WaveCyclic, WavePCI, <a href="../../WaveRT" class="internal" data-slug="WaveRT">WaveRT</a>). In modern Windows:</p>
<ul>
<li><strong>WaveCyclic</strong>: Legacy, don’t use</li>
<li><strong>WavePCI</strong>: Legacy, don’t use</li>
<li><strong><a href="../../WaveRT" class="internal" data-slug="WaveRT">WaveRT</a></strong>: The current standard (introduced in Vista)</li>
</ul>
<p><a href="../../WaveRT" class="internal" data-slug="WaveRT">WaveRT</a> (Real-Time) uses a simpler, more efficient <a href="../../Cyclic-Buffer" class="internal alias" data-slug="Cyclic-Buffer">Cyclic Buffer</a> approach. If you’re writing a new driver, use <a href="../../WaveRT" class="internal" data-slug="WaveRT">WaveRT</a>.</p>
<h2 id="the-bottom-line">The Bottom Line<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#the-bottom-line" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>This diagram shows Microsoft’s brilliant division of labor:</p>
<p><strong>Microsoft writes the hard parts:</strong></p>
<ul>
<li><a href="../../Kernel-Streaming" class="internal alias" data-slug="Kernel-Streaming">Kernel Streaming</a> infrastructure</li>
<li>Audio mixing and processing</li>
<li><a href="../../User-Mode" class="internal alias" data-slug="User-Mode">User Mode</a> to <a href="../../Kernel-Mode" class="internal alias" data-slug="Kernel-Mode">Kernel Mode</a> bridging</li>
<li>Bus protocols</li>
</ul>
<p><strong>You write the simple parts:</strong></p>
<ul>
<li>“My <a href="../../DMA" class="internal" data-slug="DMA">DMA</a> buffer is at address X&quot;</li>
<li>&quot;To start playback, write Y to <a href="../../Register" class="internal alias" data-slug="Register">register</a> Z&quot;</li>
<li>&quot;Here’s my volume control <a href="../../Register" class="internal alias" data-slug="Register">register</a>”</li>
</ul>
<p>The result: consistent audio behavior across all Windows devices, with each vendor only needing to write a few hundred lines of hardware-specific code.</p>
<hr/>
<h2 id="key-takeaway">Key Takeaway<a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#key-takeaway" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>If you’re writing an audio driver:</p>
<ul>
<li>For <strong><a href="../../USB" class="internal" data-slug="USB">USB</a>/FireWire</strong>: You’re working with <a href="../../AVStream" class="internal" data-slug="AVStream">AVStream</a> on the left</li>
<li>For <strong><a href="../../PCI" class="internal" data-slug="PCI">PCI</a>/<a href="../../PCIe" class="internal" data-slug="PCIe">PCIe</a></strong>: You’re working with <a href="../../PortCls" class="internal" data-slug="PortCls">PortCls</a> on the right, writing miniport drivers that pair with Microsoft’s port drivers</li>
</ul>
<p>The diagram is showing you where your code fits in the massive Windows audio stack.</p></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div class="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false,&quot;enableRadial&quot;:false}"></div><button class="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div class="global-graph-outer"><div class="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.2,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true,&quot;enableRadial&quot;:true}"></div></div></div><div class="toc desktop-only"><button type="button" class="toc-header" aria-controls="toc-5" aria-expanded="true"><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><ul id="list-1" class="toc-content overflow"><li class="depth-0"><a href="#understanding-the-windows-audio-architecture-diagram" data-for="understanding-the-windows-audio-architecture-diagram">Understanding the Windows Audio Architecture Diagram</a></li><li class="depth-1"><a href="#the-big-picture" data-for="the-big-picture">The Big Picture</a></li><li class="depth-1"><a href="#top-layer-audio-engine-user-mode" data-for="top-layer-audio-engine-user-mode">Top Layer: Audio Engine (User Mode)</a></li><li class="depth-1"><a href="#the-bridge-ksendpoint-audioksedll" data-for="the-bridge-ksendpoint-audioksedll">The Bridge: KSEndpoint (AudioKSE.DLL)</a></li><li class="depth-1"><a href="#kernel-mode-two-paths-to-hardware" data-for="kernel-mode-two-paths-to-hardware">Kernel Mode: Two Paths to Hardware</a></li><li class="depth-2"><a href="#left-side-avstream-class-drivers-kssys" data-for="left-side-avstream-class-drivers-kssys">Left Side: AVStream Class Drivers (KS.SYS)</a></li><li class="depth-2"><a href="#right-side-port-class-drivers-portclssys" data-for="right-side-port-class-drivers-portclssys">Right Side: Port Class Drivers (PortCls.SYS)</a></li><li class="depth-1"><a href="#the-color-coding-who-writes-what" data-for="the-color-coding-who-writes-what">The Color Coding: Who Writes What?</a></li><li class="depth-1"><a href="#following-the-data-flow" data-for="following-the-data-flow">Following the Data Flow</a></li><li class="depth-1"><a href="#why-two-paths-avstream-vs-portcls" data-for="why-two-paths-avstream-vs-portcls">Why Two Paths? (AVStream vs PortCls)</a></li><li class="depth-1"><a href="#the-bus-class-driver-layer" data-for="the-bus-class-driver-layer">The Bus Class Driver Layer</a></li><li class="depth-1"><a href="#the-adapter-driver-box" data-for="the-adapter-driver-box">The “Adapter Driver” Box</a></li><li class="depth-1"><a href="#what-about-the-hardware" data-for="what-about-the-hardware">What About the Hardware?</a></li><li class="depth-1"><a href="#modern-note-wavert-wins" data-for="modern-note-wavert-wins">Modern Note: WaveRT Wins</a></li><li class="depth-1"><a href="#the-bottom-line" data-for="the-bottom-line">The Bottom Line</a></li><li class="depth-1"><a href="#key-takeaway" data-for="key-takeaway">Key Takeaway</a></li><li class="overflow-end"></li></ul></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v1.0.0</a> © 2025</p><ul><li><a href="https://github.com/tham-le">GitHub</a></li><li><a href="https://thamle.live">Portfolio</a></li></ul></footer></div></div></body><script type="application/javascript">function n(){let t=this.parentElement;t.classList.toggle("is-collapsed");let e=t.getElementsByClassName("callout-content")[0];if(!e)return;let l=t.classList.contains("is-collapsed");e.style.gridTemplateRows=l?"0fr":"1fr"}function c(){let t=document.getElementsByClassName("callout is-collapsible");for(let e of t){let l=e.getElementsByClassName("callout-title")[0],s=e.getElementsByClassName("callout-content")[0];if(!l||!s)continue;l.addEventListener("click",n),window.addCleanup(()=>l.removeEventListener("click",n));let o=e.classList.contains("is-collapsed");s.style.gridTemplateRows=o?"0fr":"1fr"}}document.addEventListener("nav",c);
</script><script type="module">function f(i,e){if(!i)return;function r(o){o.target===this&&(o.preventDefault(),o.stopPropagation(),e())}function t(o){o.key.startsWith("Esc")&&(o.preventDefault(),e())}i?.addEventListener("click",r),window.addCleanup(()=>i?.removeEventListener("click",r)),document.addEventListener("keydown",t),window.addCleanup(()=>document.removeEventListener("keydown",t))}function y(i){for(;i.firstChild;)i.removeChild(i.firstChild)}var h=class{constructor(e,r){this.container=e;this.content=r;this.setupEventListeners(),this.setupNavigationControls(),this.resetTransform()}isDragging=!1;startPan={x:0,y:0};currentPan={x:0,y:0};scale=1;MIN_SCALE=.5;MAX_SCALE=3;cleanups=[];setupEventListeners(){let e=this.onMouseDown.bind(this),r=this.onMouseMove.bind(this),t=this.onMouseUp.bind(this),o=this.resetTransform.bind(this);this.container.addEventListener("mousedown",e),document.addEventListener("mousemove",r),document.addEventListener("mouseup",t),window.addEventListener("resize",o),this.cleanups.push(()=>this.container.removeEventListener("mousedown",e),()=>document.removeEventListener("mousemove",r),()=>document.removeEventListener("mouseup",t),()=>window.removeEventListener("resize",o))}cleanup(){for(let e of this.cleanups)e()}setupNavigationControls(){let e=document.createElement("div");e.className="mermaid-controls";let r=this.createButton("+",()=>this.zoom(.1)),t=this.createButton("-",()=>this.zoom(-.1)),o=this.createButton("Reset",()=>this.resetTransform());e.appendChild(t),e.appendChild(o),e.appendChild(r),this.container.appendChild(e)}createButton(e,r){let t=document.createElement("button");return t.textContent=e,t.className="mermaid-control-button",t.addEventListener("click",r),window.addCleanup(()=>t.removeEventListener("click",r)),t}onMouseDown(e){e.button===0&&(this.isDragging=!0,this.startPan={x:e.clientX-this.currentPan.x,y:e.clientY-this.currentPan.y},this.container.style.cursor="grabbing")}onMouseMove(e){this.isDragging&&(e.preventDefault(),this.currentPan={x:e.clientX-this.startPan.x,y:e.clientY-this.startPan.y},this.updateTransform())}onMouseUp(){this.isDragging=!1,this.container.style.cursor="grab"}zoom(e){let r=Math.min(Math.max(this.scale+e,this.MIN_SCALE),this.MAX_SCALE),t=this.content.getBoundingClientRect(),o=t.width/2,n=t.height/2,c=r-this.scale;this.currentPan.x-=o*c,this.currentPan.y-=n*c,this.scale=r,this.updateTransform()}updateTransform(){this.content.style.transform=`translate(${this.currentPan.x}px, ${this.currentPan.y}px) scale(${this.scale})`}resetTransform(){this.scale=1;let e=this.content.querySelector("svg");this.currentPan={x:e.getBoundingClientRect().width/2,y:e.getBoundingClientRect().height/2},this.updateTransform()}},C=["--secondary","--tertiary","--gray","--light","--lightgray","--highlight","--dark","--darkgray","--codeFont"],E;document.addEventListener("nav",async()=>{let e=document.querySelector(".center").querySelectorAll("code.mermaid");if(e.length===0)return;E||=await import("https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.esm.min.mjs");let r=E.default,t=new WeakMap;for(let n of e)t.set(n,n.innerText);async function o(){for(let s of e){s.removeAttribute("data-processed");let a=t.get(s);a&&(s.innerHTML=a)}let n=C.reduce((s,a)=>(s[a]=window.getComputedStyle(document.documentElement).getPropertyValue(a),s),{}),c=document.documentElement.getAttribute("saved-theme")==="dark";r.initialize({startOnLoad:!1,securityLevel:"loose",theme:c?"dark":"base",themeVariables:{fontFamily:n["--codeFont"],primaryColor:n["--light"],primaryTextColor:n["--darkgray"],primaryBorderColor:n["--tertiary"],lineColor:n["--darkgray"],secondaryColor:n["--secondary"],tertiaryColor:n["--tertiary"],clusterBkg:n["--light"],edgeLabelBackground:n["--highlight"]}}),await r.run({nodes:e})}await o(),document.addEventListener("themechange",o),window.addCleanup(()=>document.removeEventListener("themechange",o));for(let n=0;n<e.length;n++){let v=function(){let g=l.querySelector("#mermaid-space"),m=l.querySelector(".mermaid-content");if(!m)return;y(m);let w=c.querySelector("svg").cloneNode(!0);m.appendChild(w),l.classList.add("active"),g.style.cursor="grab",u=new h(g,m)},M=function(){l.classList.remove("active"),u?.cleanup(),u=null},c=e[n],s=c.parentElement,a=s.querySelector(".clipboard-button"),d=s.querySelector(".expand-button"),p=window.getComputedStyle(a),L=a.offsetWidth+parseFloat(p.marginLeft||"0")+parseFloat(p.marginRight||"0");d.style.right=`calc(${L}px + 0.3rem)`,s.prepend(d);let l=s.querySelector("#mermaid-container");if(!l)return;let u=null;d.addEventListener("click",v),f(l,M),window.addCleanup(()=>{u?.cleanup(),d.removeEventListener("click",v)})}});
</script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script src="../../postscript.js" type="module"></script></html>